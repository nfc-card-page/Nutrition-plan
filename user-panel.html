<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>پنل کاربری</title>
</head>
<body>
  <h1>پنل کاربری</h1>
  <form id="loginForm">
    <input type="text" id="username" placeholder="نام کاربری" required><br>
    <input type="password" id="password" maxlength="4" placeholder="رمز ۴ رقمی" required><br>
    <button type="submit">ورود</button>
  </form>

  <div id="userInfo"></div>
  <div id="dietPlan"></div>

  <script>
    const WORKER_URL = "https://user-data-api.clad90093.workers.dev";

    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;

      const res = await fetch(`${WORKER_URL}/user/${username}`);
      if (!res.ok) {
        alert("کاربر یافت نشد");
        return;
      }
      const user = await res.json();
      if (user.password !== password) {
        alert("رمز اشتباه است");
        return;
      }

      document.getElementById("userInfo").innerHTML = `
        <p>نام کاربری: ${user.username}</p>
        <p>سن: ${user.age}</p>
        <p>قد: ${user.height} cm</p>
        <p>وزن: ${user.weight} kg</p>
      `;

      // گرفتن برنامه غذایی
      const dietRes = await fetch(`${WORKER_URL}/diet/${username}`);
      const diet = await dietRes.json();
      if (diet.length === 0) {
        document.getElementById("dietPlan").innerText = "برنامه غذایی شما هنوز آماده نشده است.";
      } else {
        document.getElementById("dietPlan").innerHTML = `<h3>برنامه غذایی:</h3><pre>${JSON.stringify(diet, null, 2)}</pre>`;
      }
    });
  </script>
</body>
</html>
